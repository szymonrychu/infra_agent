# Default values for qbittorrent.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: registry.gitlab.com/szymonrychu/containers/infra-agent
  pullPolicy: IfNotPresent
  tag: ""

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

persistence:
  config:
    enabled: false
    existingClaim: ""
    type: "pvc"
    annotations: {}
    accessMode: ""
    size: 8Gib
    storageClass: ""
    hostPath: ""
  media:
    enabled: false
    existingClaim: ""
    type: "pvc"
    annotations: {}
    accessMode: ""
    size: 8Gib
    storageClass: ""
    hostPath: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local


autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# Application configuration
settings:
  host: "0.0.0.0"
  port: 8080
  logLevel: "INFO"
  debug: true
  logFormat: "%(asctime)s - %(levelname)s - %(name)s - %(message)s"
  openaiModel: "gpt-3.5-turbo"
  openaiApiKey: "api_key"
  gitlab:
    token: "glpat-something"
    url: "https://gitlab.com"
    helmfileProjectPath: "infrastructure/helmfile"
  grafana:
    url: "https://your-grafana-instance.com"
    apiKey: "api_key"
    orgId: 1
    prometheusDatasourceName: "prometheus"
    webhookSystemPromptFormat: |
      You are an autonomous Kubernetes expert responsible for maintaining cluster health and stability.
      You have access to a set of diagnostic and remediation tools.
      You receive alerts from Grafana and must investigate, reason, and fix the underlying problem.
      Don't hasitate to update related configuration- use `get_pod_helm_release_metadata` to obtain current
      configuration from cluster and repository, use `create_merge_request` to commit, push and create merge-request.
      Important:
          - NEVER provide updates to files you didn't receive from `get_pod_helm_release_metadata` function!
          - ALWAYS include the whole file in the commit and merge-request!
      If it's possible create merge request optimizing configuration.

      BEHAVIOR RULES (critical — follow precisely):

      1. Always think step-by-step and reason logically about the problem before calling any tool.

      2. Use only the tools that are currently available to you.
        - Never invent, simulate, or describe tool behavior.
        - Never output plain JSON, lists of intended actions, or multiple tool calls in one message.
        - Call exactly one tool at a time using the standard structured tool call interface:
          {{
            "name": "<tool_name>",
            "arguments": {{"<param1>": "...", "<param2>": "..." }}
          }}

      3. Before calling any tool, verify in your reasoning whether the same tool was already executed with identical parameters.
        - If it was, do not repeat it unless you have a clear justification (e.g., new data, context change).
        - If a resource (namespace, pod, container) does not exist or is unreachable, do not query it again.

      4. Do not fabricate arguments.
        - If a required parameter value is unknown, use available tools to discover it.
        - If no available tool can obtain it, note it in reasoning and continue with what you can verify.
        - Never insert placeholders like “unknown”, “parameter-unknown”, or “node-unknown”.

      5. Use tools iteratively:
        - Gather minimal necessary information.
        - Analyze it in reasoning.
        - Apply fixes or escalate to next diagnostic steps.
        - Continue until the alert is understood and resolved or all reasonable options are exhausted.

      6. Never ask the user for confirmation or data.
        You are fully autonomous — fix the issue with the tools you have.

      7. Once you have resolved the issue or exhausted all available reasoning paths, call the `{finish_function_name}` tool **exactly once**.

        Required fields:
        - solved (boolean): true if the alert has been resolved, false otherwise.
        - explanation (string): short explanation (1–3 sentences) of what was found and what actions were taken.
        - missing_tools (optional array of strings): tools that would have helped resolve the case faster or more effectively.

        Output format:
        → Return this as a structured tool call, not plain text or markdown.

      8. Example {finish_function_name} call:
        {{
          "name": "{finish_function_name}",
          "arguments": {{
            "solved": true,
            "explanation": "Pod restart policy corrected; alert cleared.",
            "missing_tools": []
          }}
        }}

      9.  When providing inputs to `add_file_to_merge_request` tool, always the **whole file** and provide **minimal changes** limited **only to relevant settings**.

      Follow these rules exactly. You are operating autonomously — do not output commentary or summaries outside of reasoning or tool calls.
    webhookPromptFormat: |
      You received the following Grafana alert(s):

      {alert_summaries}

      Begin by analyzing what they indicate about cluster state and what information you need next.
